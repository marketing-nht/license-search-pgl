<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PGL Procedure Lookup v3.0 (Pro)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
    .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Toggle Switch Style */
    .toggle-checkbox:checked { right: 0; border-color: #2563eb; }
    .toggle-checkbox:checked + .toggle-label { background-color: #2563eb; }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }

    /* Vertical Timeline Line */
    .timeline-line::before { content: ''; position: absolute; top: 0; bottom: 0; left: 16px; width: 2px; background: #e2e8f0; z-index: 0; }
  </style>
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.294.0",
      "htm": "https://esm.sh/htm@3.1.1"
    }
  }
  </script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useState, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      Search, FileText, Globe, Factory, ShieldCheck, 
      Zap, Wifi, Battery, AlertTriangle, BookOpen, Layers,
      ChevronDown, ChevronUp, Box
    } from 'lucide-react';
    import htm from 'htm';
    const html = htm.bind(React.createElement);

    // ==========================================
    // DỮ LIỆU THỦ TỤC & TÍNH NĂNG CHI TIẾT
    // ==========================================
    const PROCEDURES = [
      // --- NHÓM 1: MÁY TÍNH XÁCH TAY (LAPTOP) ---
      {
        id: "laptop",
        name: "Máy tính xách tay (Laptop)",
        group: "CNTT (MIC) & Năng lượng (MOIT)",
        icon: Globe,
        features: [
          { name: "An toàn điện", reg: "QCVN 132:2022/BTTTT", desc: "Thử nghiệm an toàn cho thiết bị CNTT (Bắt buộc)" },
          { name: "Tương thích điện từ (EMC)", reg: "QCVN 118:2018/BTTTT", desc: "Thử nhiễu từ trường (Bắt buộc)" },
          { name: "Kết nối Wifi (2.4/5GHz)", reg: "QCVN 54 & QCVN 65", desc: "Nếu tích hợp card Wifi (Module)" },
          { name: "Kết nối Bluetooth", reg: "QCVN 54:2020", desc: "Nếu có Bluetooth" },
          { name: "Pin Lithium (Bên trong)", reg: "QCVN 101:2020/BTTTT", desc: "Thử nghiệm an toàn cho Pin/Cell" },
          { name: "Hiệu suất năng lượng", reg: "TCVN 11848:2021", desc: "Dán nhãn năng lượng (Bộ Công Thương)" }
        ],
        import_steps: [
          "B1: Đăng ký Kiểm tra chất lượng (PQ) trên Cổng thông tin một cửa Quốc gia (VNSW).",
          "B2: Mang hàng về bảo quản (Giải tỏa hàng hóa).",
          "B3: Gửi mẫu thử nghiệm tại PGL (Safety, EMC, RF, Pin, VNEEP).",
          "B4: Nhận kết quả thử nghiệm & Chứng nhận Hợp quy (Cục Viễn thông).",
          "B5: Nộp hồ sơ hoàn thành kiểm tra trên VNSW -> Thông quan chính thức.",
          "B6: Đăng ký dán nhãn năng lượng (Online Bộ Công Thương) -> Dán tem ICT & Năng lượng trước khi bán."
        ],
        domestic_steps: [
          "B1: Thử nghiệm mẫu điển hình tại PGL.",
          "B2: Chứng nhận Hợp quy (Tại Cục Viễn thông).",
          "B3: Công bố Hợp quy (Tại Cục Viễn thông).",
          "B4: Đăng ký dán nhãn năng lượng (Bộ Công Thương).",
          "B5: Dán tem và lưu thông."
        ]
      },
      // --- NHÓM 2: MÁY TÍNH BẢNG (TABLET) ---
      {
        id: "tablet",
        name: "Máy tính bảng (Tablet)",
        group: "CNTT & Viễn thông",
        icon: Box,
        features: [
          { name: "An toàn điện", reg: "QCVN 132:2022/BTTTT", desc: "Bắt buộc từ 01/01/2024" },
          { name: "Tương thích điện từ", reg: "QCVN 18:2014 & QCVN 118:2018", desc: "EMC cho thiết bị vô tuyến" },
          { name: "Kết nối 4G/LTE", reg: "QCVN 117:2023", desc: "Nếu có khe SIM 4G" },
          { name: "Kết nối Wifi", reg: "QCVN 54 & 65", desc: "Wifi 2.4G và 5G" },
          { name: "SAR (Hấp thụ sóng)", reg: "QCVN 134:2024", desc: "Đo mức hấp thụ riêng (Body SAR)" },
          { name: "Hiệu suất năng lượng", reg: "TCVN 11848:2021", desc: "Dán nhãn năng lượng" }
        ],
        import_steps: [
          "B1: Đăng ký KTCL hàng nhập khẩu (Cục Viễn Thông).",
          "B2: Thử nghiệm trọn gói tại PGL.",
          "B3: Chứng nhận Hợp quy (RF, SAR).",
          "B4: Tự đánh giá sự phù hợp (Safety, EMC, Pin).",
          "B5: Nộp kết quả lên Cục Viễn Thông để hoàn tất thủ tục nhập khẩu."
        ],
        domestic_steps: [
          "B1: Thử nghiệm mẫu.",
          "B2: Chứng nhận Hợp quy.",
          "B3: Công bố Hợp quy.",
          "B4: Dán tem ICT & Nhãn năng lượng."
        ]
      },
      // --- NHÓM 3: ĐIỀU HÒA KHÔNG KHÍ ---
      {
        id: "ac",
        name: "Điều hòa không khí",
        group: "Gia dụng (MOST) & Năng lượng",
        icon: Factory,
        features: [
          { name: "Tương thích điện từ (EMC)", reg: "QCVN 9:2012/BKHCN", desc: "Chứng nhận CR (Bộ KHCN)" },
          { name: "An toàn điện (LVD)", reg: "TCVN 5699-2-40", desc: "Thử nghiệm an toàn (IEC 60335)" },
          { name: "Hiệu suất năng lượng", reg: "TCVN 7830:2021", desc: "Dán nhãn năng lượng (Sao năng lượng)" }
        ],
        import_steps: [
          "B1: Đăng ký Kiểm tra nhà nước về chất lượng (Sở KHCN hoặc Chi cục TĐC) tại nơi mở tờ khai.",
          "B2: Đăng ký thử nghiệm HSNL (Để dán nhãn năng lượng).",
          "B3: Lấy mẫu tại cảng/kho -> Thử nghiệm tại PGL.",
          "B4: PGL cấp Giấy chứng nhận Hợp quy (Lô hàng) & Kết quả thử nghiệm HSNL.",
          "B5: Nộp lại cho Hải quan/Sở KHCN để thông quan."
        ],
        domestic_steps: [
          "B1: Thử nghiệm mẫu điển hình tại PGL.",
          "B2: Đánh giá quá trình sản xuất (Phương thức 5) -> Cấp chứng nhận Hợp quy 3 năm.",
          "B3: Công bố Hợp quy tại Sở KHCN địa phương.",
          "B4: Công bố dán nhãn năng lượng tại Bộ Công Thương."
        ]
      },
      // --- NHÓM 4: THIẾT BỊ WIFI / ROUTER ---
      {
        id: "wifi",
        name: "Modem / Router / Access Point",
        group: "Viễn thông (MIC)",
        icon: Wifi,
        features: [
          { name: "Thu phát Wifi 2.4GHz", reg: "QCVN 54:2020/BTTTT", desc: "Công suất < 100mW (EIRP)" },
          { name: "Thu phát Wifi 5GHz", reg: "QCVN 65:2021/BTTTT", desc: "Yêu cầu dùng trong nhà/ngoài trời" },
          { name: "Tương thích điện từ (EMC)", reg: "QCVN 112:2017/BTTTT", desc: "EMC cho thiết bị vô tuyến" },
          { name: "An toàn điện", reg: "QCVN 22:2010 (Nếu có)", desc: "Tùy loại thiết bị" }
        ],
        import_steps: [
          "B1: Đăng ký KTCL trên VNSW (Cục Viễn thông).",
          "B2: Thử nghiệm RF & EMC tại PGL.",
          "B3: Chứng nhận Hợp quy (Bắt buộc).",
          "B4: Công bố Hợp quy (Self-declaration) dựa trên giấy chứng nhận.",
          "B5: Dán tem ICT Code."
        ],
        domestic_steps: [
          "B1: Thử nghiệm mẫu.",
          "B2: Chứng nhận Hợp quy.",
          "B3: Công bố Hợp quy.",
          "B4: Dán tem ICT."
        ]
      },
      // --- NHÓM 5: LÒ VI SÓNG ---
      {
        id: "microwave",
        name: "Lò vi sóng (Microwave)",
        group: "Gia dụng (MOST)",
        icon: Zap,
        features: [
          { name: "An toàn điện", reg: "QCVN 4:2009/BKHCN", desc: "Sửa đổi 1:2016 (Bắt buộc)" },
          { name: "Nhiễu điện từ (EMC)", reg: "QCVN 9:2012/BKHCN", desc: "Sửa đổi 1:2018 (Bắt buộc)" }
        ],
        import_steps: [
          "B1: Đăng ký kiểm tra chất lượng (Chi cục TĐC).",
          "B2: Thử nghiệm mẫu tại PGL.",
          "B3: Chứng nhận Hợp quy theo lô hàng (Phương thức 7).",
          "B4: Nộp giấy chứng nhận cho Chi cục TĐC -> Thông quan."
        ],
        domestic_steps: [
          "B1: Thử nghiệm mẫu.",
          "B2: Đánh giá nhà xưởng (Phương thức 5).",
          "B3: Cấp chứng nhận Hợp quy (3 năm).",
          "B4: Công bố hợp quy."
        ]
      },
      // --- NHÓM 6: ĐIỆN THOẠI DI ĐỘNG ---
      {
        id: "mobile",
        name: "Điện thoại di động",
        group: "Viễn thông (MIC)",
        icon: Box,
        features: [
          { name: "Kết nối 4G LTE", reg: "QCVN 117:2023", desc: "Bắt buộc đo VoLTE (nếu có)" },
          { name: "Kết nối 5G NR", reg: "QCVN 127, 129", desc: "Nếu hỗ trợ 5G" },
          { name: "Wifi & Bluetooth", reg: "QCVN 54, 65", desc: "" },
          { name: "Pin Lithium", reg: "QCVN 101:2020", desc: "An toàn pin" },
          { name: "SAR (Hấp thụ)", reg: "QCVN 134:2024", desc: "Đo SAR vùng đầu và thân" },
          { name: "An toàn & EMC", reg: "QCVN 132, 86, 18", desc: "" }
        ],
        import_steps: [
          "B1: Đăng ký KTCL hàng nhập khẩu (Cục Viễn thông).",
          "B2: Đo kiểm toàn diện các chỉ tiêu tại PGL.",
          "B3: Chứng nhận Hợp quy (Cục Viễn thông cấp).",
          "B4: Công bố Hợp quy và Dán tem ICT."
        ],
        domestic_steps: [
          "B1: Đo kiểm.",
          "B2: Chứng nhận Hợp quy.",
          "B3: Công bố Hợp quy."
        ]
      }
    ];

    // COMPONENT: CARD HIỂN THỊ
    const ProcedureCard = ({ item }) => {
      const [isImport, setIsImport] = useState(true); // Toggle state: True = Import, False = Domestic
      const [isOpen, setIsOpen] = useState(false);

      return html`
        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all mb-6 overflow-hidden animate-fadeIn">
          <div className="p-5 flex items-center justify-between cursor-pointer bg-gradient-to-r from-slate-50 to-white" onClick=${() => setIsOpen(!isOpen)}>
            <div className="flex items-center gap-4">
              <div className=${`w-14 h-14 rounded-xl flex items-center justify-center text-white shadow-md ${item.group.includes('CNTT') || item.group.includes('Viễn thông') ? 'bg-blue-600' : 'bg-emerald-600'}`}>
                <${item.icon} size=${28} />
              </div>
              <div>
                <h3 className="text-xl font-bold text-slate-800">${item.name}</h3>
                <span className="text-xs font-semibold text-slate-500 bg-white border border-slate-200 px-2 py-1 rounded-md mt-1 inline-block">
                  ${item.group}
                </span>
              </div>
            </div>
            <button className="text-slate-400 hover:text-blue-600 transition-colors">
              ${isOpen ? html`<${ChevronUp} size=${24} />` : html`<${ChevronDown} size=${24} />`}
            </button>
          </div>

          ${isOpen && html`
            <div className="border-t border-slate-100">
              <div className="p-6 bg-white">
                <h4 className="text-sm font-bold text-slate-700 uppercase tracking-wide mb-4 flex items-center gap-2">
                  <${ShieldCheck} size=${18} className="text-blue-600"/> Các tính năng cần thử nghiệm
                </h4>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  ${item.features.map((feat, idx) => html`
                    <div key=${idx} className="flex flex-col p-3 rounded-xl border border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-colors">
                      <div className="flex justify-between items-start mb-1">
                        <span className="font-bold text-slate-800 text-sm">${feat.name}</span>
                        <span className="text-[10px] font-bold bg-white border border-slate-200 text-slate-600 px-2 py-0.5 rounded shadow-sm">
                          ${feat.reg}
                        </span>
                      </div>
                      <p className="text-xs text-slate-500 italic">${feat.desc}</p>
                    </div>
                  `)}
                </div>
              </div>

              <div className="p-6 bg-slate-50 border-t border-slate-200">
                <div className="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                  <h4 className="text-sm font-bold text-slate-700 uppercase tracking-wide flex items-center gap-2">
                    <${Layers} size=${18} className="text-purple-600"/> Quy trình thực hiện
                  </h4>
                  
                  <div className="flex bg-white p-1 rounded-lg border border-slate-200 shadow-sm">
                    <button 
                      onClick=${() => setIsImport(true)}
                      className=${`px-4 py-1.5 rounded-md text-sm font-bold transition-all flex items-center gap-2 ${isImport ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'}`}
                    >
                      <${Globe} size=${14} /> Nhập khẩu
                    </button>
                    <button 
                      onClick=${() => setIsImport(false)}
                      className=${`px-4 py-1.5 rounded-md text-sm font-bold transition-all flex items-center gap-2 ${!isImport ? 'bg-emerald-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-100'}`}
                    >
                      <${Factory} size=${14} /> Sản xuất trong nước
                    </button>
                  </div>
                </div>

                <div className="relative pl-6 space-y-6 timeline-line">
                  ${(isImport ? item.import_steps : item.domestic_steps).map((step, idx) => html`
                    <div key=${idx} className="relative z-10 animate-fadeIn">
                      <div className=${`absolute -left-[31px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm flex items-center justify-center ${isImport ? 'bg-blue-500' : 'bg-emerald-500'}`}>
                        <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                      </div>
                      <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                        <p className="text-sm text-slate-700 leading-relaxed font-medium">
                          <span className=${`font-bold mr-1 ${isImport ? 'text-blue-600' : 'text-emerald-600'}`}>B${idx + 1}:</span> 
                          ${step}
                        </p>
                      </div>
                    </div>
                  `)}
                </div>

                <div className="mt-6 pt-4 border-t border-slate-200 flex items-start gap-3">
                  <${AlertTriangle} size=${18} className="text-amber-500 shrink-0 mt-0.5"/>
                  <p className="text-xs text-slate-500 italic">
                    Lưu ý: Đối với hàng nhập khẩu, doanh nghiệp cần đăng ký tài khoản trên <span className="font-bold">Cổng thông tin một cửa quốc gia (VNSW)</span> để thực hiện đăng ký kiểm tra chất lượng. Đối với hàng sản xuất, cần duy trì hệ thống ISO 9001 tại nhà máy.
                  </p>
                </div>
              </div>
            </div>
          `}
        </div>
      `;
    };

    const App = () => {
      const [query, setQuery] = useState('');
      
      const filteredData = useMemo(() => {
        if (!query) return PROCEDURES;
        return PROCEDURES.filter(p => 
          p.name.toLowerCase().includes(query.toLowerCase()) || 
          p.features.some(f => f.reg.toLowerCase().includes(query.toLowerCase()))
        );
      }, [query]);

      return html`
        <div className="min-h-screen flex flex-col md:flex-row bg-slate-100">
          
          <aside className="w-full md:w-80 bg-white border-r border-slate-200 p-6 hidden md:block h-screen sticky top-0 overflow-y-auto">
            <div className="flex items-center gap-3 mb-10">
              <div className="bg-indigo-600 p-3 rounded-xl text-white shadow-xl shadow-indigo-200">
                <${BookOpen} size=${28} />
              </div>
              <div>
                <h1 className="font-extrabold text-xl text-slate-900 tracking-tight">PGL Guide</h1>
                <p className="text-xs text-slate-500 font-medium">Hệ thống tra cứu quy trình</p>
              </div>
            </div>

            <div className="space-y-6">
              <div className="bg-blue-50 p-5 rounded-2xl border border-blue-100">
                <h3 className="font-bold text-blue-900 text-sm mb-2 flex items-center gap-2">
                  <${Globe} size=${16}/> Hàng Nhập khẩu
                </h3>
                <p className="text-xs text-blue-700 leading-relaxed">
                  Áp dụng cơ chế "Hậu kiểm" hoặc "Kiểm tra lô hàng". Bắt buộc đăng ký trên Cổng 1 cửa Quốc gia (VNSW).
                </p>
              </div>

              <div className="bg-emerald-50 p-5 rounded-2xl border border-emerald-100">
                <h3 className="font-bold text-emerald-900 text-sm mb-2 flex items-center gap-2">
                  <${Factory} size=${16}/> Sản xuất trong nước
                </h3>
                <p className="text-xs text-emerald-700 leading-relaxed">
                  Áp dụng Phương thức 5 (Đánh giá quá trình sản xuất). Giấy chứng nhận có hiệu lực 3 năm.
                </p>
              </div>

              <div className="pt-6 border-t border-slate-100">
                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Danh mục phổ biến</h4>
                <div className="flex flex-wrap gap-2">
                  ${['Laptop', 'Điều hòa', 'Wifi', 'Pin', 'Tivi', 'Lò vi sóng'].map(tag => html`
                    <button onClick=${() => setQuery(tag)} className="px-3 py-1 bg-slate-100 hover:bg-slate-200 rounded-full text-xs text-slate-600 transition-colors">
                      ${tag}
                    </button>
                  `)}
                </div>
              </div>
            </div>
          </aside>

          <main className="flex-1 p-4 md:p-10 h-screen overflow-y-auto">
            <div className="max-w-4xl mx-auto">
              <div className="mb-8">
                <h2 className="text-3xl font-black text-slate-900 mb-2">Tra cứu Thủ tục Hợp quy</h2>
                <p className="text-slate-500">Hướng dẫn chi tiết quy trình Thử nghiệm, Chứng nhận & Công bố cho từng loại sản phẩm.</p>
              </div>

              <div className="relative mb-8 group z-10">
                <${Search} className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors" size=${22} />
                <input 
                  type="text" 
                  className="w-full pl-14 pr-6 py-4 bg-white border-2 border-slate-200 rounded-2xl shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 transition-all text-lg placeholder:text-slate-400"
                  placeholder="Nhập tên sản phẩm (VD: Laptop, Tủ lạnh)..."
                  value=${query}
                  onChange=${e => setQuery(e.target.value)}
                  autoFocus
                />
              </div>

              <div className="space-y-4">
                ${filteredData.length > 0 ? filteredData.map(item => html`
                  <${ProcedureCard} key=${item.id} item=${item} />
                `) : html`
                  <div className="flex flex-col items-center justify-center py-20 opacity-60">
                    <${FileText} size=${64} className="text-slate-300 mb-4"/>
                    <p className="text-slate-500 font-medium">Không tìm thấy dữ liệu phù hợp</p>
                  </div>
                `}
              </div>
            </div>
          </main>
        </div>
      `;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
</body>
</html>
